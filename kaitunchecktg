
local Playergss = PlayerStatus:CraftPage(1)
Playergss:Seperator("Player Status")

-- Discord Webhook URL - Webhook URL mẫu (thay thế nếu cần)
local webhookUrl = "https://discord.com/api/webhooks/1353378925295964311/7xwiS-HM8kEmN4NJq-4lafwegUUmjt94HJa7KgZsMQ78H1VwoMM_E_YCBRmPvCoS3Nt2"

-- Khai báo dịch vụ cần thiết
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Hàm để gửi dữ liệu đến webhook
function PostWebhook(Url, message)
    -- Chọn hàm request phù hợp với môi trường của bạn
    local request = http_request or request or HttpPost or syn.request
    
    -- Gửi HTTP request với message được mã hóa dưới dạng JSON
    local response = request({
        Url = Url,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode(message)
    })
    
    print("Webhook Response: " .. response.StatusCode)
    return response
end

-- Hàm tạo thông báo cho webhook
function CreateBloxFruitsMessage()
    -- Tạo màu ngẫu nhiên cho embed
    local randomColor = math.random(0, 0xFFFFFF)
    
    -- Lấy thông tin người chơi
    local player = Players.LocalPlayer
    local character = player.Character
    
    -- Xác định thế giới
    local worldText = "Unknown"
    if World1 then worldText = "1"
    elseif World2 then worldText = "2"
    elseif World3 then worldText = "3"
    end
    
    -- Thu thập dữ liệu kiếm
    local swords = {}
    local legendarySwords = {}
    local guns = {}
    local accessories = {}
    
    pcall(function()
        local inventoryWeapons = game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("getInventoryWeapons")
        
        -- Danh sách kiếm thông thường cần kiểm tra
        local swordsList = {
            "Saber", "Rengoku", "Midnight Blade", "Dragon Trident", 
            "Yama", "Buddy Sword", "Canvander", "Twin Hooks", 
            "Spikey Trident", "Hallow Scythe", "Dark Dagger", "Tushita"
        }
        
        -- Danh sách kiếm huyền thoại cần kiểm tra
        local legendaryList = {"Shisui", "Saddi", "Wando", "True Triple Katana"}
        
        -- Danh sách súng cần kiểm tra
        local gunsList = {"Kabucha", "Acidum Rifle", "Bizarre Rifle"}
        
        -- Danh sách phụ kiện cần kiểm tra
        local accessoriesList = {"Dark Coat", "Ghoul Mask", "Swan Glasses", "Pale Scarf", "Valkyrie Helmet"}
        
        -- Kiểm tra từng vũ khí trong kho đồ
        for _, weapon in pairs(inventoryWeapons) do
            -- Kiểm tra kiếm thông thường
            for _, swordName in pairs(swordsList) do
                if weapon.Name == swordName then
                    table.insert(swords, swordName)
                end
            end
            
            -- Kiểm tra kiếm huyền thoại
            for _, legendaryName in pairs(legendaryList) do
                if weapon.Name == legendaryName then
                    table.insert(legendarySwords, legendaryName)
                end
            end
            
            -- Kiểm tra súng
            for _, gunName in pairs(gunsList) do
                if weapon.Name == gunName then
                    table.insert(guns, gunName)
                end
            end
            
            -- Kiểm tra phụ kiện
            for _, accName in pairs(accessoriesList) do
                if weapon.Name == accName then
                    table.insert(accessories, accName)
                end
            end
        end
    end)
    
    -- Thu thập thông tin về kỹ năng cận chiến
    local meleeSkills = {}
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuySuperhuman",true) == 1 then
        table.insert(meleeSkills, "Superhuman")
    end
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuyDeathStep",true) == 1 then
        table.insert(meleeSkills, "Death Step")
    end
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuySharkmanKarate",true) == 1 then
        table.insert(meleeSkills, "Sharkman Karate")
    end
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuyElectricClaw",true) == 1 then
        table.insert(meleeSkills, "Electric Claw")
    end
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuyDragonTalon",true) == 1 then
        table.insert(meleeSkills, "Dragon Talon")
    end
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BuyGodHuman",true) == 1 then
        table.insert(meleeSkills, "God Human")
    end
    
    -- Thu thập thông tin về nhiệm vụ
    local completedQuests = {}
    
    if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BartiloQuestProgress","Bartilo") == 3 then
        table.insert(completedQuests, "Bartilo Quest")
    end
    
    local unlockables = game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("GetUnlockables")
    if type(unlockables) == "table" and unlockables.FlamingoAccess ~= nil then
        table.insert(completedQuests, "Don Swan Quest")
    end
    
    if game:GetService("ReplicatedStorage").Remotes["CommF_"]:InvokeServer("ZQuestProgress", "General") == 1 then
        table.insert(completedQuests, "Kill Don Swan")
    end
    
    -- Tạo thông điệp với các trường nhúng
    local message = {
        ["embeds"] = {
            {
                ["title"] = "**Blox Fruits - Thông tin người chơi**",
                ["description"] = "Thông tin chi tiết về nhân vật của bạn trong Blox Fruits",
                ["type"] = "rich",
                ["color"] = randomColor,
                ["fields"] = {
                    {
                        ["name"] = "**Thông tin cơ bản**",
                        ["value"] = "```" ..
                                   "Tên: " .. player.Name .. "\n" ..
                                   "Thế giới: " .. worldText .. "\n" ..
                                   "Chủng tộc: " .. player.Data.Race.Value .. "\n" ..
                                   "Trái ác quỷ: " .. player.Data.DevilFruit.Value .. "\n" ..
                                   "Cấp độ: " .. player.Data.Level.Value .. "\n" ..
                                   "Tiền thưởng: " .. player.leaderstats["Bounty/Honor"].Value ..
                                   "```",
                        ["inline"] = false
                    }
                },
                ["footer"] = {
                    ["text"] = "Blox Fruits Stats • " .. os.date("%d/%m/%Y %H:%M:%S")
                },
                ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%S")
            }
        }
    }
    
    -- Thêm trường kiếm nếu có
    if #swords > 0 then
        local swordsText = ""
        for _, sword in ipairs(swords) do
            swordsText = swordsText .. "- " .. sword .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Kiếm**",
            ["value"] = "```" .. swordsText .. "```",
            ["inline"] = true
        })
    end
    
    -- Thêm trường kiếm huyền thoại nếu có
    if #legendarySwords > 0 then
        local legendarySwordsText = ""
        for _, sword in ipairs(legendarySwords) do
            legendarySwordsText = legendarySwordsText .. "- " .. sword .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Kiếm huyền thoại**",
            ["value"] = "```" .. legendarySwordsText .. "```",
            ["inline"] = true
        })
    end
    
    -- Thêm trường kỹ năng cận chiến nếu có
    if #meleeSkills > 0 then
        local meleeText = ""
        for _, melee in ipairs(meleeSkills) do
            meleeText = meleeText .. "- " .. melee .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Kỹ năng cận chiến**",
            ["value"] = "```" .. meleeText .. "```",
            ["inline"] = true
        })
    end
    
    -- Thêm trường súng nếu có
    if #guns > 0 then
        local gunsText = ""
        for _, gun in ipairs(guns) do
            gunsText = gunsText .. "- " .. gun .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Súng**",
            ["value"] = "```" .. gunsText .. "```",
            ["inline"] = true
        })
    end
    
    -- Thêm trường phụ kiện nếu có
    if #accessories > 0 then
        local accessoriesText = ""
        for _, acc in ipairs(accessories) do
            accessoriesText = accessoriesText .. "- " .. acc .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Phụ kiện**",
            ["value"] = "```" .. accessoriesText .. "```",
            ["inline"] = true
        })
    end
    
    -- Thêm trường nhiệm vụ đã hoàn thành nếu có
    if #completedQuests > 0 then
        local questsText = ""
        for _, quest in ipairs(completedQuests) do
            questsText = questsText .. "- " .. quest .. "\n"
        end
        
        table.insert(message.embeds[1].fields, {
            ["name"] = "**Nhiệm vụ đã hoàn thành**",
            ["value"] = "```" .. questsText .. "```",
            ["inline"] = true
        })
    end
    
    return message
end

-- Hiển thị thông tin trên giao diện như script gốc
Playergss:Label("Name : "..game.Players.LocalPlayer.Name)

if World1 then
    Playergss:Label("World : 1")
end

if World2 then
    Playergss:Label("World : 2")
end

if World3 then
    Playergss:Label("World : 3")
end

Playergss:Label("Race : "..game:GetService("Players").LocalPlayer.Data.Race.Value)
Playergss:Label("Fruit : "..game.Players.LocalPlayer.Data.DevilFruit.Value)
Playergss:Label("Level : "..game.Players.localPlayer.Data.Level.Value)
Playergss:Label("Bounty : "..game:GetService("Players").LocalPlayer.leaderstats["Bounty/Honor"].Value)

-- Thêm box để nhập webhook URL
Playergss:TextBox("Discord Webhook URL", webhookUrl, function(url)
    if url and url ~= "" then
        webhookUrl = url
        Playergss:Label("✅ Webhook URL đã được cập nhật")
    end
end)

-- Nút kiểm tra webhook
Playergss:Button("Kiểm tra Webhook", function()
    local testMessage = {
        ["content"] = "Kiểm tra kết nối webhook từ Blox Fruits!"
    }
    
    local success, response = pcall(function()
        return PostWebhook(webhookUrl, testMessage)
    end)
    
    if success and response and response.StatusCode == 204 then
        Playergss:Label("✅ Webhook hoạt động tốt!")
    else
        Playergss:Label("❌ Webhook không hoạt động. Kiểm tra URL.")
    end
end)

-- Nút gửi thông tin
Playergss:Button("Gửi thông tin đến Discord", function()
    local statsMessage = CreateBloxFruitsMessage()
    
    local success, response = pcall(function()
        return PostWebhook(webhookUrl, statsMessage)
    end)
    
    if success and response and response.StatusCode == 204 then
        Playergss:Label("✅ Đã gửi thống kê thành công!")
    else
        Playergss:Label("❌ Gửi thất bại. Kiểm tra URL webhook.")
    end
end)

-- Thêm tính năng tự động gửi
local autoSendEnabled = false
local autoSendInterval = 3600 -- 1 giờ mặc định

Playergss:Toggle("Tự động gửi thông tin", false, function(value)
    autoSendEnabled = value
    
    if autoSendEnabled then
        -- Tạo một thread mới để tự động gửi
        spawn(function()
            while autoSendEnabled do
                local statsMessage = CreateBloxFruitsMessage()
                PostWebhook(webhookUrl, statsMessage)
                wait(autoSendInterval)
            end
        end)
        Playergss:Label("✅ Tự động gửi đã bật")
    else
        Playergss:Label("❌ Tự động gửi đã tắt")
    end
end)

Playergss:Slider("Chu kỳ gửi (phút)", 5, 180, 60, function(value)
    autoSendInterval = value * 60 -- Chuyển phút thành giây
end)

-- Gửi thông báo khi script được tải lần đầu
spawn(function()
    wait(3) -- Đợi 3 giây cho script tải hoàn tất
    local initialMessage = {
        ["content"] = "",
        ["embeds"] = {
            {
                ["title"] = "**Blox Fruits Webhook Connected**",
                ["description"] = "Script webhook đã được tải thành công cho người chơi: " .. Players.LocalPlayer.Name,
                ["color"] = 5814783, -- Màu xanh lá
                ["footer"] = {
                    ["text"] = "Blox Fruits Stats • " .. os.date("%d/%m/%Y %H:%M:%S")
                }
            }
        }
    }
    
    pcall(function()
        PostWebhook(webhookUrl, initialMessage)
    end)
end)

-- Phần còn lại của script gốc (kiếm, nhiệm vụ, kiếm huyền thoại, cận chiến, súng, phụ kiện)
local Swordss = PlayerStatus:CraftPage(2)
Swordss:Seperator("Sword")

-- (Code còn lại giữ nguyên như script gốc)
local Saber = Swordss:Label("❌ : Saber")
local Rengoku = Swordss:Label("❌ : Rengoku")
local Midnight_Blade = Swordss:Label("❌ : Midnight Blade")
local Dragon_Trident = Swordss:Label("❌ : Dragon Trident")
local Yama = Swordss:Label("❌ : Yama")
local Buddy_Sword = Swordss:Label("❌ : Buddy Sword")
local Canvander = Swordss:Label("❌ : Canvander")
local Twin_Hooks = Swordss:Label("❌ : Twin Hooks")
local Spikey_Trident = Swordss:Label("❌ : Spikey Trident")
local Hallow_Scythe = Swordss:Label("❌ : Hallow Scythe")
local Dark_Dagger = Swordss:Label("❌ : Dark Dagger")
local Tushita = Swordss:Label("❌ : Tushita")

spawn(function()
    while task.wait() do
        pcall(function()
            for i,v in pairs(game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("getInventoryWeapons")) do
                if v.Name == "Saber" then
                    Saber:Set("✅ : Saber")
                end
                if v.Name == "Rengoku" then
                    Rengoku:Set("✅ : Rengoku")
                end
                if v.Name == "Midnight Blade" then
                    Midnight_Blade:Set("✅ : Midnight Blade")
                end
                if v.Name == "Dragon Trident" then
                    Dragon_Trident:Set("✅ : Dragon Trident")
                end
                if v.Name == "Yama" then
                    Yama:Set("✅ : Yama")
                end
                if v.Name == "Buddy Sword" then
                    Buddy_Sword:Set("✅ : Buddy Sword")
                end
                if v.Name == "Canvander" then
                    Canvander:Set("✅ : Canvander")
                end
                if v.Name == "Twin Hooks" then
                    Twin_Hooks:Set("✅ : Twin Hooks")
                end
                if v.Name == "Spikey Trident" then
                    Spikey_Trident:Set("✅ : Spikey Trident")
                end
                if v.Name == "Hallow Scythe" then
                    Hallow_Scythe:Set("✅ : Hallow Scythe")
                end
                if v.Name == "Dark Dagger" then
                    Dark_Dagger:Set("✅ : Dark Dagger")
                end
                if v.Name == "Tushita" then
                    Tushita:Set("✅ : Tushita")
                end
            end
        end)
    end
end)

local Questss = PlayerStatus:CraftPage(2)
Questss:Seperator("Quest")

local Bartilo_Quest = Questss:Label("❌ : Bartilo Quest")
local Don_Swan_Quest = Questss:Label("❌ : Don Swan Quest")
local Kill_Don_Swan = Questss:Label("❌ : Kill Don Swan")

spawn(function()
    while task.wait() do
        if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("BartiloQuestProgress","Bartilo") == 3 then
            Bartilo_Quest:Set("✅ : Bartilo Quest")
        end
        
        if game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("GetUnlockables").FlamingoAccess == nil then
            --Nothing
        else
            Don_Swan_Quest:Set("✅ : Don Swan Quest")
        end
        
        if game:GetService("ReplicatedStorage").Remotes["CommF_"]:InvokeServer("ZQuestProgress", "General") == 1 then
            Kill_Don_Swan:Set("✅ : Kill Don Swan")
        end
    end
end)
